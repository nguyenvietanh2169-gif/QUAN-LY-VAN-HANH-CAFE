<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barista Control Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .bar-header { background: #4e342e; color: white; padding: 15px; border-bottom: 4px solid #d4a373; }
        .menu-btn { margin-bottom: 10px; width: 100%; text-align: left; padding: 15px; font-weight: bold; border-radius: 10px; }
        .order-card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; border-left: 6px solid #ffc107; }
        .order-card.done { border-left-color: #28a745; opacity: 0.6; }
        .time-badge { font-size: 0.8rem; color: #666; }
        #orderContainer { height: 80vh; overflow-y: auto; padding: 10px; }
    </style>
</head>
<body>

<div class="bar-header shadow-sm mb-4">
    <div class="container d-flex justify-content-between align-items-center">
        <h4 class="mb-0">‚òï CAFE OPERATOR</h4>
        <div id="connection-status" class="badge bg-success">ƒêang k·∫øt n·ªëi</div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4 border-end">
            <h5 class="mb-3">Menu Nhanh</h5>
            <div class="row">
                <div class="col-6"><button class="btn btn-outline-dark menu-btn" onclick="quickAdd('Cafe ƒêen')">‚òï Cafe ƒêen</button></div>
                <div class="col-6"><button class="btn btn-outline-dark menu-btn" onclick="quickAdd('Cafe S·ªØa')">ü•§ Cafe S·ªØa</button></div>
                <div class="col-6"><button class="btn btn-outline-dark menu-btn" onclick="quickAdd('B·∫°c X·ªâu')">ü•õ B·∫°c X·ªâu</button></div>
                <div class="col-6"><button class="btn btn-outline-dark menu-btn" onclick="quickAdd('Tr√† ƒê√†o')">üçë Tr√† ƒê√†o</button></div>
            </div>
            <hr>
            <input type="text" id="customInput" class="form-control mb-2" placeholder="M√≥n kh√°c ho·∫∑c ghi ch√∫...">
            <button class="btn btn-primary w-100" onclick="createOrder()">X√ÅC NH·∫¨N ƒê∆†N</button>
        </div>

        <div class="col-md-8">
            <h5 class="mb-3 d-flex justify-content-between">
                ƒê∆°n h√†ng hi·ªán t·∫°i 
                <span id="orderCount" class="badge bg-danger">0</span>
            </h5>
            <div id="orderContainer">
                </div>
        </div>
    </div>
</div>

<audio id="notifSound">
    <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
</audio>

<script>
    // D√ÅN CONFIG C·ª¶A B·∫†N V√ÄO ƒê√ÇY
    const firebaseConfig = {
        apiKey: "AIzaSyB-rTmNSqnZ18y15esxbBQko-Gf0TqqmVQ",
        authDomain: "quan-ly-van-hanh.firebaseapp.com",
        databaseURL: "https://quan-ly-van-hanh-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "quan-ly-van-hanh",
        storageBucket: "quan-ly-van-hanh.firebasestorage.app",
        messagingSenderId: "983773797210",
        appId: "1:983773797210:web:155c433149e20c633e3163",
        measurementId: "G-R1ZC0MC2W4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function quickAdd(item) {
        document.getElementById('customInput').value = item;
    }

    function createOrder() {
        const name = document.getElementById('customInput').value;
        if (!name) return;
        db.ref('orders').push({
            name: name,
            status: 'pending',
            timestamp: Date.now()
        });
        document.getElementById('customInput').value = '';
    }

    // Theo d√µi ƒë∆°n m·ªõi ƒë·ªÉ ph√°t √¢m thanh
    let firstLoad = true;
    db.ref('orders').on('child_added', (snapshot) => {
        if (!firstLoad) {
            document.getElementById('notifSound').play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
        }
    });

    // C·∫≠p nh·∫≠t giao di·ªán
    db.ref('orders').on('value', (snapshot) => {
        firstLoad = false;
        const data = snapshot.val();
        const container = document.getElementById('orderContainer');
        container.innerHTML = '';
        let pendingCount = 0;

        if (data) {
            const list = Object.keys(data).map(key => ({ id: key, ...data[key] }))
                         .sort((a, b) => b.timestamp - a.timestamp);

            list.forEach(order => {
                if(order.status === 'pending') pendingCount++;
                
                const waitTime = Math.floor((Date.now() - order.timestamp) / 60000);
                const card = document.createElement('div');
                card.className = `card order-card ${order.status === 'done' ? 'done' : ''}`;
                card.innerHTML = `
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0">${order.name}</h5>
                            <small class="time-badge">${waitTime} ph√∫t tr∆∞·ªõc</small>
                        </div>
                        ${order.status === 'pending' 
                            ? `<button class="btn btn-success" onclick="markDone('${order.id}')">HO√ÄN T·∫§T</button>` 
                            : `<span class="text-success fw-bold">‚úì XONG</span>`}
                    </div>
                `;
                container.appendChild(card);
            });
        }
        document.getElementById('orderCount').innerText = pendingCount;
    });

    function markDone(id) {
        db.ref('orders/' + id).update({ status: 'done' });
    }
</script>
</body>
</html>
