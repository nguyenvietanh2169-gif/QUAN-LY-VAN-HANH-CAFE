<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Cafe POS - Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .tab-content { display: none; }
        .active-tab { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-active { color: #4f46e5; border-top: 3px solid #4f46e5; }
    </style>
</head>
<body class="pb-24">

<nav class="bg-white border-b sticky top-0 z-50 px-6 py-4 flex justify-between items-center shadow-sm">
    <div class="flex items-center gap-2">
        <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-black">S</div>
        <h1 class="text-xl font-extrabold tracking-tight text-gray-800">SMART CAFE <span class="text-indigo-600">PRO</span></h1>
    </div>
    <div class="flex items-center gap-3">
        <span id="status" class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
        <p id="timer" class="text-sm font-semibold text-gray-500"></p>
    </div>
</nav>

<div class="max-w-5xl mx-auto p-4 lg:p-6">

    <div id="admin" class="tab-content">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                <p class="text-gray-500 text-sm font-medium">Doanh thu h√¥m nay</p>
                <h3 id="revenueToday" class="text-2xl font-black mt-1 text-indigo-600">0ƒë</h3>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                <p class="text-gray-500 text-sm font-medium">ƒê∆°n ƒë√£ ho√†n th√†nh</p>
                <h3 id="doneStats" class="text-2xl font-black mt-1 text-green-600">0</h3>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                <p class="text-gray-500 text-sm font-medium">Hi·ªáu su·∫•t ph·ª•c v·ª•</p>
                <h3 class="text-2xl font-black mt-1 text-orange-500">~12p/m√≥n</h3>
            </div>
        </div>
        <div class="bg-white p-6 rounded-3xl shadow-sm mb-8 border border-gray-100">
            <h4 class="font-bold mb-4">Bi·ªÉu ƒë·ªì ƒë∆°n h√†ng</h4>
            <canvas id="orderChart" height="150"></canvas>
        </div>
    </div>

    <div id="pos" class="tab-content active-tab">
        <div class="flex flex-col lg:flex-row gap-6">
            <div class="w-full lg:w-1/3">
                <div class="bg-white p-6 rounded-3xl shadow-sm sticky top-24 border border-gray-100">
                    <h4 class="font-bold mb-4">Menu Nhanh</h4>
                    <div id="menuGrid" class="grid grid-cols-2 gap-3 mb-4">
                        </div>
                    <input type="text" id="orderNote" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 border-none focus:ring-2 focus:ring-indigo-500" placeholder="Ghi ch√∫ th√™m...">
                    <button onclick="submitOrder()" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition">G·ª¨I XU·ªêNG B·∫æP</button>
                </div>
            </div>
            <div class="w-full lg:w-2/3">
                <div id="activeOrders" class="space-y-4">
                    </div>
            </div>
        </div>
    </div>

    <div id="staff" class="tab-content">
        <div class="bg-white p-6 rounded-3xl shadow-sm mb-6 border border-gray-100">
            <h4 class="font-bold mb-4">Nh·∫≠t k√Ω Check-in</h4>
            <div id="attendanceLog" class="text-sm text-gray-600 space-y-2 max-h-48 overflow-y-auto"></div>
            <button onclick="checkIn()" class="mt-4 w-full bg-green-600 text-white py-3 rounded-2xl font-bold">NH√ÇN VI√äN ƒêI·ªÇM DANH</button>
        </div>
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
            <h4 class="font-bold mb-4">G·ª≠i b√°o c√°o / ƒê∆°n t·ª´</h4>
            <textarea id="reportText" class="w-full p-4 bg-gray-50 rounded-2xl h-32 mb-4 border-none" placeholder="S·∫øp ∆°i, qu√°n h√¥m nay..."></textarea>
            <button onclick="sendReport()" class="w-full bg-gray-800 text-white py-3 rounded-2xl font-bold">G·ª¨I CHO S·∫æP</button>
        </div>
    </div>

</div>

<footer class="fixed bottom-0 left-0 right-0 bg-white border-t px-6 py-3 flex justify-around items-center shadow-2xl">
    <button onclick="switchTab('admin', this)" class="flex flex-col items-center gap-1 text-gray-400">
        <span class="text-xl">üìä</span><span class="text-[10px] font-bold uppercase">B√°o c√°o</span>
    </button>
    <button onclick="switchTab('pos', this)" class="flex flex-col items-center gap-1 nav-active pt-2">
        <span class="text-xl">‚òï</span><span class="text-[10px] font-bold uppercase">Ph·ª•c v·ª•</span>
    </button>
    <button onclick="switchTab('staff', this)" class="flex flex-col items-center gap-1 text-gray-400">
        <span class="text-xl">üë•</span><span class="text-[10px] font-bold uppercase">Nh√¢n s·ª±</span>
    </button>
</footer>

<script>
    // GI·ªÆ NGUY√äN FIREBASE CONFIG C·ª¶A B·∫†N
    const firebaseConfig = {
        apiKey: "AIzaSyB-rTmNSqnZ18y15esxbBQko-Gf0TqqmVQ",
        authDomain: "quan-ly-van-hanh.firebaseapp.com",
        databaseURL: "https://quan-ly-van-hanh-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "quan-ly-van-hanh",
        storageBucket: "quan-ly-van-hanh.firebasestorage.app",
        messagingSenderId: "983773797210",
        appId: "1:983773797210:web:155c433149e20c633e3163"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // D·ªØ li·ªáu Menu m·∫´u (C√≥ th·ªÉ t√πy bi·∫øn b√°n cho kh√°ch)
    const menu = [
        {name: 'Cafe ƒêen', price: 25000}, {name: 'Cafe S·ªØa', price: 30000},
        {name: 'B·∫°c X·ªâu', price: 35000}, {name: 'Tr√† ƒê√†o', price: 40000},
        {name: 'Matcha', price: 45000}, {name: 'N∆∞·ªõc Cam', price: 35000}
    ];

    function initMenu() {
        const grid = document.getElementById('menuGrid');
        menu.forEach(item => {
            grid.innerHTML += `<button onclick="setNote('${item.name}')" class="p-3 bg-gray-50 hover:bg-indigo-50 rounded-2xl text-xs font-bold text-gray-700 border border-transparent hover:border-indigo-200 transition">${item.name}<br><span class="text-indigo-600">${item.price/1000}k</span></button>`;
        });
    }

    function switchTab(id, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
        document.getElementById(id).classList.add('active-tab');
        document.querySelectorAll('footer button').forEach(b => b.classList.remove('nav-active', 'pt-2'));
        btn.classList.add('nav-active', 'pt-2');
    }

    function setNote(val) { document.getElementById('orderNote').value = val; }

    function submitOrder() {
        const name = document.getElementById('orderNote').value;
        if(!name) return;
        const price = menu.find(m => m.name === name.split(' - ')[0])?.price || 0;
        db.ref('orders').push({ name, price, status: 'pending', timestamp: Date.now() });
        document.getElementById('orderNote').value = '';
    }

    // REALTIME LOGIC
    db.ref('orders').on('value', (snap) => {
        const data = snap.val();
        const container = document.getElementById('activeOrders');
        container.innerHTML = '';
        let totalRev = 0; let doneCount = 0;

        if(data) {
            Object.keys(data).reverse().forEach(id => {
                const o = data[id];
                if(o.status === 'done') {
                    totalRev += o.price;
                    doneCount++;
                }
                const time = Math.floor((Date.now() - o.timestamp)/60000);
                if(o.status === 'pending') {
                    container.innerHTML += `
                    <div class="bg-white p-5 rounded-3xl shadow-sm flex justify-between items-center border-l-8 border-orange-500">
                        <div><h5 class="font-bold text-gray-800">${o.name}</h5><small class="text-gray-400">${time}p tr∆∞·ªõc</small></div>
                        <button onclick="markDone('${id}')" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold">XONG</button>
                    </div>`;
                }
            });
        }
        document.getElementById('revenueToday').innerText = totalRev.toLocaleString() + 'ƒë';
        document.getElementById('doneStats').innerText = doneCount;
    });

    function markDone(id) { db.ref('orders/' + id).update({ status: 'done' }); }

    // Bi·ªÉu ƒë·ªì ƒë∆°n gi·∫£n
    const ctx = document.getElementById('orderChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: { labels: ['6h', '9h', '12h', '15h', '18h', '21h'], datasets: [{ label: 'ƒê∆°n h√†ng', data: [5, 12, 19, 10, 25, 15], borderColor: '#4f46e5', tension: 0.4 }] }
    });

    initMenu();
    setInterval(() => { document.getElementById('timer').innerText = new Date().toLocaleTimeString('vi-VN'); }, 1000);
</script>
</body>
</html>
